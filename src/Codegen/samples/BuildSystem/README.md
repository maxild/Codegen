## Codegen Build System

The build system will not run on a normal build. It is a manual step to generate C# files.

### Pipeline toolchain

The build system is a simple pipeline, where sql data is transformed to c# files.

Following the "Unix principle" we use a tool pipeline

1. dotnet-cgdata
2. dotnet-cgcsharp
3. dotnet-format (provided by Microsoft)

The workflow in the pipeline looks like

```
db data |----cgdata---->
  json data file (checked in) |----cgcsharp---->
    C# file |----format---->
      Formatted C# file (checked in)
```

### GIT

The generated data files and the generated C# files are both checked into GIT.
This is done such that it is easy to see changes to important data without
writing complex queries, when regenerating data.

Another important reason, is that it is possible to change the generated C# code without having a database connection, because all data is in GIT.

### Scripts

The build system is written in two PowerShell scripts

1. `./install-codegen-tools.ps1`: Will setup dotnet-cgdata, dotnet-cgcsharp and dotnet-format.
2. `./codegen.ps1 [-target all|data|csharp]`: Will generate data and/or C# files.

### Generated files

The primary files generated by the codegen pipeline are

1. `data/<name>.json` files. One file for each dataset (`cgdata`).
2. `src/Brf.Domus.SampleModels/<name>.generated.cs`. One for each dataset (`cgcsharp` + `format`).

### Diagnostics

Some diagnostic files can be found in the `build` folder

1. `<template>.g.cshtml.cs`: One for each Razor template (Razor templates are found in the `templates` folder). Can be used to learn how the Razor compiler is generating its output, because the generated 'printer-type' is quite readable.
2. `format-report.json`: Diagnostic report from the format tool. Can be used to see if any formatting was necessary.
